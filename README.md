# ML_callcenter

Проект по предсказанию, позвонит ли пользователь в колл‑центр после оформления заказа, на основе поведения в сессии и данных о заказе.

## Цель
- Предсказать target `is_callcenter` для каждого заказа
- Основная метрика: ROC‑AUC.
- Доп. цель: понять поведенческие паттерны по типам страниц и времени заказа

## Данные
Файлы лежат в `data/`:
- `train.csv` — заказы с таргетом `is_callcenter`.
- `test.csv` — заказы без таргета.
- `t1_webstat.csv` — логи просмотров страниц в рамках сессий

Ключевые поля:
- `train.csv`: `order_id`, `create_time`, `sessionkey_id`, `is_callcenter`, признаки товара/трафика.
- `t1_webstat.csv`: `sessionkey_id`, `date_time`, `page_type`, `pageview_number`, `pageview_duration_sec`, `category_id`.

## Основные шаги проекта
1. Загрузка данных и первичный анализ.
2. Генерация признаков из логов `t1_webstat` и временных метрик.
3. Обработка данных (заполнение/удаление неиспользуемых столбцов).
4. Разделение на группы по времени создания заказа относительно сессии.
5. Обучение моделей (логрег) отдельно для каждой группы, расчет ROC‑AUC.
6. Аналитические наблюдения и проверка гипотез.

## Признаки, созданные на основе данных:
### Временные признаки
- `time_diff_create_start` — разница между `create_time` и началом сессии (мин).
- `time_diff_create_end` — разница между `create_time` и концом сессии (мин).
- `time_diff_start_end` — длина сессии (мин).
- `create_position_ratio` — положение заказа внутри сессии.

### Поведенческие признаки по страницам
- Кол-во просмотров страниц (`pageview_amount`).
- Кол-во уникальных типов страниц.
- Счётчики посещений по каждому типу страниц (`page_type_*`).
- Тип последней страницы (`last_page_type`).
- Статистики времени на странице: среднее/сумма/STD.
- Доли посещений по типам страниц (`page_type_ratio_*`).
- Повторы типов страниц (`page_type_repeat_ratio`).
- Статистика интервалов между страницами.
- Средний час/день недели сессии.

### Признаки по категории
- `last_category_is_nan` — последняя категория внутри сессии пустая или нет.

### Признаки по заказам
- `order_num` — номер заказа в рамках одной сессии.

## Разделение на группы по времени
На основе `time_diff_create_start`:
- `instant`  (< 10 мин)
- `short`    (< 35 мин)
- `medium`   (< 120 мин)
- `long`     (< 600 мин)
- `very_long`(>= 600 мин)

Для каждой группы обучается отдельная модель, затем считается общий ROC‑AUC по всем валидациям.

## Модель
Логистическая регрессия в пайплайне:
- `SimpleImputer(strategy='median')`
- `StandardScaler()`
- `LogisticRegression(penalty='l1', solver='liblinear', class_weight='balanced', max_iter=1000, C=1)`

## Валидация и метрики
- Валидация: отложенная часть внутри каждой группы (`val_frac=0.2`).
- Итоговая метрика: ROC‑AUC по всем группам.

Результаты:
- Бейзлайн логрег на ~20 фичах: ROC‑AUC ~0.88.
- Разделение на группы по времени + отдельные модели: ROC‑AUC ~0.93 (столько же на тесте - соревнование на kaggle)

## Визуализации и наблюдения
- barplot зависимости `last_page_type` и вероятности звонка
- матрица переходов между типами страниц.
- гистограммы по `time_diff_create_start`.

## Идеи, которые не сработали
- Сложные фичи движения между страницами не дали заметного прироста.
- Визуальный анализ распределений часто не разделял классы.
- Разделение на «первый/не первый заказ в сессии» улучшений не дало.

## Структура проекта
```
ML_callcenter/
├─ README.md
├─ project.ipynb
└─ data/
   ├─ train.csv
   ├─ test.csv
   └─ t1_webstat.csv
```


